<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdn.plot.ly/plotly-3.0.1.min.js"></script>
        <script src="epa.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
        <script>
            function loadNTeams(n) {
                let sortedTeams = Object.keys(window.ranks).sort((a, b) => window.ranks[a][0] - window.ranks[b][0]).slice(window.latestIndex, window.latestIndex + n);
                window.latestIndex += n;
                let teamsTable = document.getElementById("teams");
                sortedTeams.forEach((team) => {
                    let teamRow = document.createElement("tr");
                    teamRow.className = "p-2.5 text-center text-white border-b border-gray-500 hover:bg-gray-800 hover:text-white cursor-pointer transition-all";
                    teamRow.addEventListener('click', function(e) {
                        window.location = `epa.html?team=${team}`;
                    });
                    let rankCol = document.createElement("td");
                    rankCol.className = "p-2.5";
                    rankCol.innerText = `${window.ranks[team][0]}`;
                    let teamCol = document.createElement("td");
                    teamCol.className = "p-2.5";
                    teamCol.innerText = `${team}`;
                    let epaCol = document.createElement("td");
                    epaCol.className = "p-2.5";
                    epaCol.innerText = `${Number(window.ranks[team][1]).toFixed(1)}`;
                    teamRow.appendChild(rankCol);
                    teamRow.appendChild(teamCol);
                    teamRow.appendChild(epaCol);
                    let percentile = window.ranks[team][0] / Object.keys(window.ranks).length;
                    setElementColorForEPA(teamRow, percentile);
                    teamsTable.appendChild(teamRow);
                });
            }
            window.onload = async () => {
                window.ranks = await getEPARanks(2024);
                window.latestIndex = 0;
                loadNTeams(100);
            };
        </script>
    </head>

    <body class="bg-gray-800 p-5 flex flex-row w-full justify-center">
        <div class="flex flex-col w-2/3">
            <table class="table-auto w-full rounded-lg bg-gray-700">
                <thead>
                <tr class="gap-2 p-2.5 border-b border-thick border-white">
                    <th class="text-white text-center p-2.5">Rank</th>
                    <th class="text-white text-center p-2.5">Team</th>
                    <th class="text-white text-center p-2.5">EPA</th>
                </tr>
                </thead>
                <tbody id="teams">

                </tbody>
            </table>
            <div class="w-full flex flex-row justify-center">
                <button class="border text-sm rounded-lg p-2.5 bg-gray-700 border-gray-600 placeholder-gray-400 text-white focus:ring-gray-100 focus:border-gray-100" onclick="loadNTeams(1000);">Load more teams</button>
            </div>
        </div>
    </body>
</html>